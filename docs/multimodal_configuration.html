<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Configuration for multimodal integration &mdash; WebAtlas 0.4.0 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=6c02275b"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Running" href="run.html" />
    <link rel="prev" title="Configuration" href="configuration.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            WebAtlas
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html#environment-setup">Environment setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Configuration for multimodal integration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#parameters-file">Parameters file</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#with-additional-features">With additional features</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="run.html">Running</a></li>
<li class="toctree-l1"><a class="reference internal" href="visualise.html">Visualising</a></li>
<li class="toctree-l1"><a class="reference external" href="https://cellatlas.io/webatlas">Demos</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules.html">Modules</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Example Workflows</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="examples/visium.html">Visium</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples/xenium.html">Xenium</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Project Links</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="citing.html">Citation</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/haniffalab/webatlas-pipeline">Source Code</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/haniffalab/webatlas-pipeline/issues">Issue Tracker</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/haniffalab/webatlas-app">WebAtlas App</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Project Teams</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://www.sanger.ac.uk/group/bayraktar-group">Bayraktar Lab</a></li>
<li class="toctree-l1"><a class="reference external" href="https://haniffalab.com">Haniffa Lab</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.openmicroscopy.org/">Open Microscopy Environment</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">WebAtlas</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Configuration for multimodal integration</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/multimodal_configuration.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="configuration-for-multimodal-integration">
<span id="multimodal-configuration"></span><h1>Configuration for multimodal integration<a class="headerlink" href="#configuration-for-multimodal-integration" title="Link to this heading"></a></h1>
<p>The WebAtlas pipeline can process a group of datasets that share common features to be visualised together.
This requires a YAML parameters file similar to <a class="reference internal" href="configuration.html#parameters-file"><span class="std std-ref">the one used to run the main pipeline.</span></a>.
The outputs generated by running the main conversion pipeline serve as inputs for this multimodal integration pipeline.</p>
<p>The multimodal integration pipeline performs several tasks:</p>
<ol class="arabic simple">
<li><p>Reindex each dataset by a user-inputed offset so ID’s do not clash between them.</p></li>
<li><p><em>Optionally</em>, concatenate other observation-by-feature matrices or categorical values to the expression matrix to enable their visualisation as continuous values. For example, a celltype prediction matrix and/or celltype categories.</p></li>
<li><p>Find the intersection of features between all datasets and subset them to visualise only the intersection (as including features not present in all datasets can produce misleading visualisations.)
<strong>Note</strong> the features are intersected using their index in the AnnData objects (<code class="docutils literal notranslate"><span class="pre">var</span></code> table). All datasets must use the same type of data as index for the intersection to be correctly computed. For example, all datasets use names as index, or all datasets use IDs as index.</p></li>
</ol>
<p>After running the main conversion pipeline you can populate the required YAML parameters file to run the multimodal integration pipeline</p>
<section id="parameters-file">
<span id="multimodal-parameters-file"></span><h2>Parameters file<a class="headerlink" href="#parameters-file" title="Link to this heading"></a></h2>
<p>The parameters file looks like this:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">outdir</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/path/to/output/&quot;</span>

<span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://localhost:3000/</span>
<span class="nt">project</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my_project</span>
<span class="nt">title</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;My</span><span class="nv"> </span><span class="s">Project&quot;</span>

<span class="nt">data</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span>
<span class="w">    </span><span class="nt">dataset</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scrnaseq</span>
<span class="w">    </span><span class="nt">obs_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cell</span>
<span class="w">    </span><span class="nt">anndata</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/path/to/main/output/scrnaseq-anndata.zarr</span>
<span class="w">    </span><span class="nt">offset</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">    </span><span class="nt">is_spatial</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">    </span><span class="nt">vitessce_options</span><span class="p">:</span>
<span class="w">      </span><span class="nt">spatial</span><span class="p">:</span>
<span class="w">        </span><span class="nt">xy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">obsm/spatial</span>
<span class="w">      </span><span class="nt">mappings</span><span class="p">:</span>
<span class="w">        </span><span class="nt">obsm/X_umap</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="nv">1</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="nt">matrix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">X</span>
<span class="w">  </span><span class="p p-Indicator">-</span>
<span class="w">    </span><span class="nt">dataset</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">visium</span>
<span class="w">    </span><span class="nt">obs_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spot</span>
<span class="w">    </span><span class="nt">anndata</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/path/to/main/output/visium-anndata.zarr</span>
<span class="w">    </span><span class="nt">offset</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000000</span>
<span class="w">    </span><span class="nt">is_spatial</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">raw_image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/path/to/main/output/visium-raw.zarr</span>
<span class="w">    </span><span class="nt">label_image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/path/to/main/output/visium-label.zarr</span>
<span class="w">    </span><span class="nt">vitessce_options</span><span class="p">:</span>
<span class="w">      </span><span class="nt">spatial</span><span class="p">:</span>
<span class="w">        </span><span class="nt">xy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">obsm/spatial</span>
<span class="w">      </span><span class="nt">matrix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">X</span>
</pre></div>
</div>
<p>In contrast to the main conversion pipeline’s parameters file, this file includes a single <cite>project</cite> to which multiple <cite>datasets</cite> belong to.</p>
<p>Each <code class="docutils literal notranslate"><span class="pre">dataset</span></code> block defines the name of the dataset and paths to the converted data and image files (if any).</p>
<p>Each <code class="docutils literal notranslate"><span class="pre">dataset</span></code> also requires a set of <code class="docutils literal notranslate"><span class="pre">vitessce_options</span></code> that specify the location of certain data (spatial coordinates, embeddings, expression matrix, etc.) within the AnnData object that is processed/generated.
This follows the same structure as in the <a class="reference internal" href="configuration.html#vitessce-options"><span class="std std-ref">main conversion’s vitessce_options</span></a>.</p>
<p>Additionally, each <code class="docutils literal notranslate"><span class="pre">dataset</span></code> requires:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">obs_type</span></code>, the type of observation of the dataset. For example, “cell” or “spot”.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">offset</span></code>, an integer offset to add to the dataset’s ID’s so they don’t clash with the other datasets.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">is_spatial</span></code>, whether the dataset contains spatial information and has associated image files (raw and/or label images)</p></li>
</ul>
<p>Given that raw images are only read but not modified the pipeline does not generate new output from them.
In order for the output directory (defined by <code class="docutils literal notranslate"><span class="pre">outdir</span></code>) to contain all necessary files that need to be served for the web application to consume,
by default, the pipeline copies the raw images to the output directory.
This process can take a long time depending on the size of the image.
You may want to manually copy or move the image or serve it from its own directory separate from the rest of the output.
The default copying can be disabled by setting <code class="docutils literal notranslate"><span class="pre">copy_raw:</span> <span class="pre">false</span></code> as a project-wide parameter (at the same level as <code class="docutils literal notranslate"><span class="pre">outdir</span></code>, <code class="docutils literal notranslate"><span class="pre">project</span></code>, etc).
For example,</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">outdir</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/path/to/output/&quot;</span>
<span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://localhost:3000/</span>
<span class="nt">project</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my_project</span>
<span class="nt">title</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;My</span><span class="nv"> </span><span class="s">Project&quot;</span>
<span class="nt">copy_raw</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</pre></div>
</div>
<section id="with-additional-features">
<h3>With additional features<a class="headerlink" href="#with-additional-features" title="Link to this heading"></a></h3>
<p>Using the above example parameters file to run the multimodal integration pipeline will run the reindexing and intersection steps.
To perform the concatenation of additional features (like celltypes) to visualise them as continuous values, some extra parameters need to be added.</p>
<p>As a project-wide parameter (at the same level as <code class="docutils literal notranslate"><span class="pre">outdir</span></code>, <code class="docutils literal notranslate"><span class="pre">project</span></code>, etc.):</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">extend_feature_name</span></code>, the name of the additional feature. For example, “celltype”</p></li>
</ul>
<p>And at a <code class="docutils literal notranslate"><span class="pre">dataset</span></code> level:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">extend_feature</span></code>, the location of the additional feature information.
This can be either the path to a <em>cell2location</em> output file, or the location within the AnnData object where the feature is stored as a categorical within <code class="docutils literal notranslate"><span class="pre">obs</span></code>.
For example, <code class="docutils literal notranslate"><span class="pre">/path/to/c2l.h5ad</span></code> containing predicted continuous values, or <code class="docutils literal notranslate"><span class="pre">obs/celltype</span></code> containing categoricals.</p></li>
</ul>
<p>The full parameters file will then look like this</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">outdir</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/path/to/output/&quot;</span>

<span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://localhost:3000/</span>
<span class="nt">project</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my_project</span>
<span class="nt">title</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;My</span><span class="nv"> </span><span class="s">Project&quot;</span>

<span class="nt">extend_feature_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">celltype</span>

<span class="nt">data</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span>
<span class="w">    </span><span class="nt">dataset</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scrnaseq</span>
<span class="w">    </span><span class="nt">obs_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cell</span>
<span class="w">    </span><span class="nt">anndata</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/path/to/main/output/scrnaseq-anndata.zarr</span>
<span class="w">    </span><span class="nt">extend_feature</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">obs/celltype</span>
<span class="w">    </span><span class="nt">offset</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">    </span><span class="nt">is_spatial</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">    </span><span class="nt">vitessce_options</span><span class="p">:</span>
<span class="w">      </span><span class="nt">spatial</span><span class="p">:</span>
<span class="w">        </span><span class="nt">xy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">obsm/spatial</span>
<span class="w">      </span><span class="nt">mappings</span><span class="p">:</span>
<span class="w">        </span><span class="nt">obsm/X_umap</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="nv">1</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="nt">matrix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">X</span>
<span class="w">  </span><span class="p p-Indicator">-</span>
<span class="w">    </span><span class="nt">dataset</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">visium</span>
<span class="w">    </span><span class="nt">obs_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spot</span>
<span class="w">    </span><span class="nt">anndata</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/path/to/main/output/visium-anndata.zarr</span>
<span class="w">    </span><span class="nt">extend_feature</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/path/to/c2l.h5ad</span>
<span class="w">    </span><span class="nt">offset</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000000</span>
<span class="w">    </span><span class="nt">is_spatial</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">raw_image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/path/to/main/output/visium-raw.zarr</span>
<span class="w">    </span><span class="nt">label_image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/path/to/main/output/visium-label.zarr</span>
<span class="w">    </span><span class="nt">vitessce_options</span><span class="p">:</span>
<span class="w">      </span><span class="nt">spatial</span><span class="p">:</span>
<span class="w">        </span><span class="nt">xy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">obsm/spatial</span>
<span class="w">      </span><span class="nt">matrix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">X</span>
</pre></div>
</div>
<p>With this parameters the multimodal integration pipeline will concatenate the expression matrix with the additional feature values so both can be queried and visualised across datasets within the same portal.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="configuration.html" class="btn btn-neutral float-left" title="Configuration" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="run.html" class="btn btn-neutral float-right" title="Running" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Haniffa Lab.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>